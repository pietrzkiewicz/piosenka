{% extends "songs/base.html" %}
{% load staticfiles %}
{% load thumbnail %}

{% block title %}{{ song }} - tekst i akordy{% endblock title %}
{% block description %}Opracowanie piosenki {{ song.title }} w śpiewniku Piosenki z tekstem{% endblock description %}

{% block extra-scripts %}
<script>
var transpositionUrls = []
{% for t in "a"|rjust:"12" %}
transpositionUrls.push("{{ song.get_absolute_url }}transpose/{{ forloop.counter0 }}/");
{% endfor %}
</script>

<script src="{% static "scripts/trigger.js" %}?stamp=12"></script>
{% endblock extra-scripts %}

{% block content %}
<div class="container main">
  <div class="row">
    <div class="col-md-8">
      <div class="section">
        <div class="content">
          <h1 class="remove-top-margin">{{ song }}
            {% include "components/content_status_span.html" with item=song %}
          </h1>

          <div class="row song-header">
            <div class="col-md-6">
              <div class="song-info">
                {% if song.original_title %}
                <p><b>Tytuł oryginalny:</b> <i>{{ song.original_title }}</i></p>
                {% endif %}

                {% if song.text_authors %}
                <p><b>Tekst:</b>
                {% for author in song.text_authors %}
                <a href="{{author.get_absolute_url}}">{{ author }}</a>
                {% if not forloop.last %},{% endif %}
                {% endfor %}
                </p>
                {% endif %}

                {% if song.composers %}
                <p><b>Muzyka:</b>
                {% for composer in song.composers %}
                <a href="{{composer.get_absolute_url}}">{{ composer }}</a>
                {% if not forloop.last %},{% endif %}
                {% endfor %}
                </p>
                {% endif %}

                {% if song.translators %}
                <p><b>Tłumaczenie:</b>
                {% for translator in song.translators %}
                <a href="{{translator.get_absolute_url}}">{{ translator }}</a>
                {% if not forloop.last %},{% endif %}
                {% endfor %}
                </p>
                {% endif %}

                {% if song.performers %}
                <p><b>Wykonanie:</b>
                {% for performer in song.performers %}
                <a href="{{performer.get_absolute_url}}">{{ performer }}</a>
                {% if not forloop.last %},{% endif %}
                {% endfor %}
                </p>
                {% endif %}

                {% if song.capo %}
                <p><b>Kapodaster:</b> {{ song.capo }} </p>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <div class="song-gadget hidden-print">
                <div class="gadget-row">
                  <button type="button" class="btn btn-sm btn-default trans-up-trigger">
                    <span class="glyphicon glyphicon-arrow-up" title="półton w górę"></span>
                  </button>
                  <button type="button" class="btn btn-sm btn-default trans-home-trigger">
                    <span class="glyphicon glyphicon-home" title="zapis oryginalny"></span>
                  </button>
                  <button type="button" class="btn btn-sm btn-default trans-down-trigger">
                    <span class="glyphicon glyphicon-arrow-down" title="półton w dół"></span>
                  </button>
                  <span data-toggle="tooltip" data-placement="right" title="Transponuj
                  akordy w górę lub w dół." class="tip">
                    <span class="glyphicon glyphicon-question-sign"></span>
                  </span>
                </div>

                <div class="gadget-row">
                  <button type="button" class="btn btn-primary btn-sm chords-trigger chords-normal-trigger">
                    <span class="glyphicon glyphicon-music" title="{% if song.has_extra_chords %}podstawowe akordy{% else %}tekst i akordy{% endif %}"></span>
                  </button>
                  <button type="button" class="btn btn-default btn-sm chords-trigger chords-repeated-trigger" {% if not song.has_extra_chords %}disabled{% endif %}>
                    <span class="glyphicon glyphicon-repeat" title="wszystkie akordy"></span>
                  </button>
                  <button type="button" class="btn btn-default btn-sm chords-trigger chords-none-trigger">
                    <span class="glyphicon glyphicon-font" title="tylko tekst"></span>
                  </button>
                  <span data-toggle="tooltip" data-placement="right" title="Wyświetl lub
                  ukryj dodatkowe akordy." class="tip">
                    <span class="glyphicon glyphicon-question-sign"></span>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <br />

          <div class="lyrics">
            {{ lyrics|safe }}
          </div>

          {% include "components/content_foot.html" with action="Dodane" item=song %}
        </div>
      </div>
    </div>

    <div class="col-md-4 hidden-print">
      <div class="section">
        <h1>Wersja do druku
          <span data-toggle="tooltip" data-placement="bottom" title="Opracowanie
          zostanie wydrukowane w wybranej tonacji, bez nagłówka i bocznego
          menu. Twoja przeglądarka pozwoli dostosować parametry przed
          rozpoczęciem drukowania." class="tip tip pull-right">
            <span class="glyphicon glyphicon-question-sign"></span>
          </span>
        </h1>
        <p>
        <a href="javascript:window.print()" title="drukuj opracowanie">Drukuj</a>
        </p>
      </div>

      {% for annotation in annotations %}
      <div class="section">
        <h1 id="{{ annotation.get_id }}">{{ annotation.title }}
          {% include "components/content_status_span.html" with item=annotation %}
        </h1>
        {% if annotation.image %}
        <div class="thumbnail-host">
          <img src="{{ annotation.image|thumbnail_url:'imagethumb'}}" width="100%" class="img-responsive" />
            <div class="thumbnail-caption on-hover">
              <p class="pull-right"><a href="{{ annotation.image.url }}">pełny rozmiar</a></p>
            </div>
        </div>
        {% endif %}
        {{ annotation.text_html|safe }}
        {% if annotation.source_url1 or annotation.source_url2 or annotation.source_ref1 or annotation.source_ref2 %}
        <small>
            <ul class="list-unstyled">
              <li><b>Źródła</b>:</li>
              {% if annotation.source_url1 %}<li><a href="{{ annotation.source_url1 }}">{{ annotation.source_url1|truncatechars:50 }}</a></li>{% endif %}
              {% if annotation.source_url2 %}<li><a href="{{ annotation.source_url2 }}">{{ annotation.source_url2|truncatechars:50 }}</a></li>{% endif %}
              {% if annotation.source_ref1 %}<li>{{ annotation.source_ref1 }}</li>{% endif %}
              {% if annotation.source_ref2 %}<li>{{ annotation.source_ref2 }}</li>{% endif %}
            </ul>
        </small>
        {% endif %}
        {% include "components/content_foot.html" with action="Dodane" item=annotation %}
      </div>
      {% endfor %}

      {% if song.score1 or song.score2 or song.score3 %}
      <div class="section">
        <h1>Nuty</h1>
        {% if song.score1 %}
        <center><a href="{{song.score1.url}}"><img src='{{ song.score1|thumbnail_url:'scorethumb' }}'/></a></center><br />
        {% endif %}	
        {% if song.score2 %}
        <center><a href="{{song.score2.url}}"><img src='{{ song.score2|thumbnail_url:'scorethumb' }}'/></a></center><br />
        {% endif %}	
        {% if song.score3 %}
        <center><a href="{{song.score3.url}}"><img src='{{ song.score3|thumbnail_url:'scorethumb' }}'/></a></center><br />
        {% endif %}	
      </div>
      {% endif %}

      {% if song.external_links %}
      <div class="section">
        <h1>Linki</h1>
        <ul class="list-unstyled">
          {% for link in song.external_links %}
          <li><a href="{{link.1}}" target="_blank">{{link.0}}</a></li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if user.is_authenticated %}
      <div class="section">
        <h1>Dodaj adnotację</h1>
        <p style="text-align: center">
        <a href="{{ song.get_add_annotation_url }}"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
        </p>
      </div>
      {% endif %}
    </div>
  </div>
  {% include "base/rows/disqus.html" with disqus_id=song.slug %}
</div>
{% endblock content %}
